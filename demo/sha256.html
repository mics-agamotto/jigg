<!doctype html>
<html>
  <head>
    <title>Garbled Circuit JS 2PC</title>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/dist/jigg.js" type="text/javascript"></script>
  </head>
  <body style="font-family: sans-serif; margin: 2em;">
    <h1 style="margin-bottom: 0.25em;">SHA-256 Garbled Circuit in JavaScript</h1>
    <h3 style="margin-top: 0em;">(<a href="http://stevengoldfeder.com/projects/circuits/sha256Final.txt">Source</a> and <a href="https://homes.esat.kuleuven.be/~nsmart/MPC/sha-256-test.txt">Test Vectors</a>)</h3>
    <select id="circuit" style="display: none;">
      <option value="sha256.txt">SHA256 (input 256-bits each)</option>
    </select>

    <p style="margin-top: 1em; margin-bottom: 0;">Enter a 64 digit (256bit) haxadecimal to compute on:</p>
    <input id="input" autocomplete="off" style="margin-top: 1em; margin-bottom: 0.5em; font-family: monospace; width: 42em;" value="0000000000000000000000000000000000000000000000000000000000000000" />
    <select id="partytype">
      <option value="Garbler">Garbler</option>
      <option value="Evaluator" selected="selected">Evaluator</option>
    </select>
    <br>
    <pre> ^--- Least significant
      Garbler takes in the first 256 bits of the input, evaluator takes the second half.</pre>
    <button onclick="start()">Compute</button> <br> <br>
    <div id="results"></div>
  </body>

  <script type="text/javascript">
    const progress = function (status, start, total, error) {
      if (status === 'error') {
        document.getElementById('results').innerHTML += '<h3 style="color: red;">' + error.toString() + '</h3>';
        console.log(error);
        return;
      }
      if (status === 'garbling' || status === 'evaluating') {
        document.getElementById('results').innerHTML += '<h4>' + status + ': ' + start + '/' + total + '</h4>';
        return;
      }
      document.getElementById('results').innerHTML += '<h4>' + status + '</h4>';
    };
    const start = function () {
      const input = $('#input').val();
      const role = $('#partytype').val();

      $.ajax('circuits/bristol/sha-256.txt').then(function (circuit) {
        const agent = new JIGG(role);
        agent.addProgressListener(progress);
        agent.loadCircuit(circuit);
        agent.setInput(agent.hexutils.hex2bin(input).split('').map(Number));
        agent.getOutput().then(function (output) {
          output = agent.hexutils.bin2hex(output.join(''));
          document.getElementById('results').innerHTML += '<h3 style="color: green;">Results: ' + output + '</h3>';
        });
        agent.start();
      });
    };
  </script>
</html>
